{
    "name": "probe-rs-debugger",
    "displayName": "Debugger for probe-rs",
    "version": "1.0.0",
    "publisher": "probe-rs",
    "description": "probe-rs Debug Adapter for VS Code.",
    "author": {
        "name": "Jack Nopp√©",
        "email": "noppej@hotmail.com"
    },
    "license": "MIT, Apache-2.0",
    "keywords": [
        "probe-rs rust embedded debug cortex cortex-m cortex-a riscv risc-v RTT SVD unwind disassemble"
    ],
    "engines": {
        "vscode": "^1.75.1"
    },
    "icon": "images/probe-rs-debugger.png",
    "categories": [
        "Debuggers"
    ],
    "private": true,
    "sponsor": {
        "url": "https://github.com/sponsors/probe-rs"
    },
    "homepage": "https://probe.rs/",
    "repository": {
        "type": "git",
        "url": "https://github.com/probe-rs/vscode.git"
    },
    "bugs": {
        "url": "https://github.com/probe-rs/vscode/issues"
    },
    "scripts": {
        "probe-rs: getDebugProtocolLatest": "curl -LJs https://microsoft.github.io/debug-adapter-protocol/debugAdapterProtocol.json -o dap/debugProtocol.json",
        "probe-rs:Update Dev Dependencies": "yarn upgrade --latest",
        "probe-rs:package": "vsce package",
        "vscode:prepublish": "yarn run package-ext && yarn run package-web",
        "publish": "vsce publish",
        "login": "vsce login probe-rs",
        "compile": "tsc -p ./",
        "lint": "eslint src --ext ts",
        "watch": "webpack --watch --devtool nosources-source-map  --config ./build/extension.webpack.config.js",
        "watch2": "tsc -watch -p ./",
        "pretest": "yarn run compile && yarn run lint && prettier --check .",
        "package-ext": "webpack --mode production --config ./build/extension.webpack.config.js",
        "compile-web": "webpack --devtool nosources-source-map --config ./build/web-extension.webpack.config.js",
        "watch-web": "webpack --watch --devtool nosources-source-map  --config ./build/web-extension.webpack.config.js",
        "package-web": "webpack --mode production --config ./build/web-extension.webpack.config.js"
    },
    "enabledApiProposals": [],
    "dependencies": {
        "@vscode/debugadapter": "^1.58.0",
        "await-notify": "1.0.1",
        "get-port": "^6.1.2"
    },
    "devDependencies": {
        "@types/glob": "^8.0.0",
        "@types/mocha": "^10.0.1",
        "@types/node": "^18.11.18",
        "@types/vscode": "^1.74.0",
        "@typescript-eslint/eslint-plugin": "^5.48.1",
        "@typescript-eslint/parser": "^5.48.1",
        "@vscode/debugprotocol": "^1.58.0",
        "@vscode/vsce": "^2.17.0",
        "eslint": "^8.31.0",
        "get-port": "^6.1.2",
        "glob": "^8.0.3",
        "mocha": "^10.2.0",
        "prettier": "^2.8.1",
        "ts-loader": "^9.4.2",
        "typescript": "^4.9.4",
        "webpack": "^5.75.0",
        "webpack-cli": "^5.0.1"
    },
    "main": "./dist/ext/extension.js",
    "browser": "./dist/web/extension.js",
    "activationEvents": [
        "onDebug"
    ],
    "workspaceTrust": {
        "request": "never"
    },
    "contributes": {
        "breakpoints": [
            {
                "language": "rust"
            }
        ],
        "debuggers": [
            {
                "type": "probe-rs-debug",
                "label": "Debug adapter on top of probe-rs",
                "languages": [
                    "rust"
                ],
                "configurationAttributes": {
                    "launch": {
                        "required": [
                            "chip",
                            "coreConfigs"
                        ],
                        "properties": {
                            "server": {
                                "type": "string",
                                "description": "Optionally connect to an existing `probe-rs-debugger` session on IP and Port, e.g. '127.0.0.1:50000'",
                                "default": "127.0.0.1:50000"
                            },
                            "consoleLogLevel": {
                                "type": "string",
                                "description": "The level of log info printed to the console. This does NOT affect the RUST_LOG defined in the `env` property.",
                                "enum": [
                                    "Console",
                                    "Info",
                                    "Debug"
                                ],
                                "enumDescriptions": [
                                    "The console will only contain error messages and process status messages.",
                                    "The console log will also contain high level information about interactions between the extension and the debug adapter.",
                                    "The console log will also contain detailed information about interactions between the extension and the debug adapter."
                                ],
                                "default": "Console"
                            },
                            "runtimeExecutable": {
                                "type": "string",
                                "description": "An OS resolvable path to the Probe-rs debugger executable.",
                                "default": "probe-rs-debugger"
                            },
                            "runtimeArgs": {
                                "type": "array",
                                "items": {
                                    "type": "string"
                                },
                                "description": "String array of arguments to provide the startup arguments for the Probe-rs debugger executable.",
                                "default": [
                                    "debug",
                                    "--dap"
                                ]
                            },
                            "env": {
                                "additionalProperties": {
                                    "type": "string"
                                },
                                "default": {},
                                "description": "Environment variables defined as a key value pair. The 'key' is the name of the environment variable, and the 'value' is value of the environment variable.",
                                "type": "object"
                            },
                            "cwd": {
                                "type": "string",
                                "description": "The working directory of the debugger, typically the RUST crate root",
                                "default": "${workspaceFolder}"
                            },
                            "probe": {
                                "type": "string",
                                "description": "Use this flag to select a specific probe in the list. Use '--probe VID:PID' or '--probe VID:PID:Serial' if you have more than one probe with the same VID:PID."
                            },
                            "chip": {
                                "type": "string",
                                "description": "Please specify the appropriate chip from the list of supported chips reported by running `probe-rs-debugger list-chips`."
                            },
                            "connectUnderReset": {
                                "type": "boolean",
                                "description": "This option will result in the target reset pin being held high during the attach operation.",
                                "default": false
                            },
                            "speed": {
                                "type": "number",
                                "description": "Specify the protocol speed in kHz."
                            },
                            "wireProtocol": {
                                "type": "string",
                                "description": "The correct wire Protocol to use.",
                                "enum": [
                                    "Swd",
                                    "Jtag"
                                ],
                                "enumDescriptions": [
                                    "Use the Serial Wire Debug (SWD) protocol.",
                                    "Use the Joint Test Action Group (JTAG) protocol."
                                ]
                            },
                            "allowEraseAll": {
                                "type": "boolean",
                                "description": "Allow the session to erase all memory of the chip or reset it to factory default.",
                                "default": true
                            },
                            "flashingConfig": {
                                "type": "object",
                                "description": "These flashing options are applied when flashing one or more core `program_binary` files to the target memory.",
                                "flashingEnabled": {
                                    "type": "boolean",
                                    "description": "Flash the target before debugging.",
                                    "default": true
                                },
                                "resetAfterFlashing": {
                                    "type": "boolean",
                                    "description": "Reset all cores on the target after flashing.",
                                    "default": true
                                },
                                "haltAfterReset": {
                                    "type": "boolean",
                                    "description": "Halt all cores on the target after reset.",
                                    "default": true
                                },
                                "fullChipErase": {
                                    "type": "boolean",
                                    "description": "Do a full chip erase, versus page-by-page erase.",
                                    "default": false
                                },
                                "restoreUnwrittenBytes": {
                                    "type": "boolean",
                                    "description": "Restore erased bytes that will not be rewritten from ELF.",
                                    "default": false
                                }
                            },
                            "coreConfigs": {
                                "type": "array",
                                "description": "Each MCU core will have a mandatory `coreIndex`, `programBinary`, and `chip` as well as several other optional properties.",
                                "items": {
                                    "required": [
                                        "programBinary"
                                    ],
                                    "coreIndex": {
                                        "type": "number",
                                        "description": "The zero based index of the MCU core for this session",
                                        "default": 0
                                    },
                                    "programBinary": {
                                        "type": "string",
                                        "description": "The path (relative to `cwd` or absolute) to the binary for your target firmware",
                                        "default": "./target/thumbv7em-none-eabihf/debug/${workspaceFolderBasename}"
                                    },
                                    "svdFile": {
                                        "type": "string",
                                        "description": "The path (relative to `cwd` or absolute) to the CMCIS-SVD file for your target core",
                                        "default": "./CMSIS.SVD"
                                    },
                                    "rttEnabled": {
                                        "type": "boolean",
                                        "description": "If true, the debugger will open an RTT Terminal tab for each of the active channels on the target.",
                                        "default": false
                                    },
                                    "rttChannelFormats": {
                                        "type": "array",
                                        "items": {
                                            "channelNumber": {
                                                "type": "number",
                                                "description": "The channel number to which this data format applies. If any active channel numbers are omitted, we will assume the default will be `dataFormat=String', and 'showTimestamps=false'."
                                            },
                                            "dataFormat": {
                                                "type": "string",
                                                "description": "One of the supported data formats for RTT channels.",
                                                "enum": [
                                                    "String",
                                                    "BinaryLE",
                                                    "Defmt"
                                                ],
                                                "enumDescriptions": [
                                                    "String (text) format.",
                                                    "Binary Little Endian format.",
                                                    "Deferred formatting (see: https://defmt.ferrous-systems.com)."
                                                ],
                                                "default": "String"
                                            },
                                            "showTimestamps": {
                                                "type": "boolean",
                                                "default": false,
                                                "description": "Enable the inclusion of timestamps in the RTT output for `dataFormat=String`."
                                            },
                                            "showLocation": {
                                                "type": "boolean",
                                                "default": true,
                                                "description": "Enable the inclusion of Defmt location information in the RTT output for `dataFormat=Defmt`."
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "attach": {
                        "required": [
                            "chip",
                            "coreConfigs"
                        ],
                        "properties": {
                            "server": {
                                "type": "string",
                                "description": "Optionally onnect to an existing `probe-rs-debugger` session on IP and Port, e.g. '127.0.0.1:50000'",
                                "default": "127.0.0.1:50000"
                            },
                            "consoleLogLevel": {
                                "type": "string",
                                "description": "The level of log info printed to the console. This does NOT affect the RUST_LOG defined in the `env` property.",
                                "enum": [
                                    "Console",
                                    "Info",
                                    "Debug"
                                ],
                                "enumDescriptions": [
                                    "The console will only contain error messages and process status messages.",
                                    "The console log will also contain high level information about interactions between the extension and the debug adapter.",
                                    "The console log will also contain detailed information about interactions between the extension and the debug adapter."
                                ],
                                "default": "Console"
                            },
                            "runtimeExecutable": {
                                "type": "string",
                                "description": "An OS resolvable path to the Probe-rs debugger executable.",
                                "default": "probe-rs-debugger"
                            },
                            "runtimeArgs": {
                                "type": "array",
                                "items": {
                                    "type": "string"
                                },
                                "description": "String array of arguments to provide the startup arguments for the Probe-rs debugger executable.",
                                "default": [
                                    "debug",
                                    "--dap"
                                ]
                            },
                            "env": {
                                "additionalProperties": {
                                    "type": "string"
                                },
                                "default": {},
                                "description": "Environment variables defined as a key value pair. The 'key' is the name of the environment variable, and the 'value' is value of the environment variable.",
                                "type": "object"
                            },
                            "cwd": {
                                "type": "string",
                                "description": "The working directory of the debugger, typically the RUST crate root",
                                "default": "${workspaceFolder}"
                            },
                            "probe": {
                                "type": "string",
                                "description": "Use this flag to select a specific probe in the list. Use '--probe VID:PID' or '--probe VID:PID:Serial' if you have more than one probe with the same VID:PID."
                            },
                            "chip": {
                                "type": "string",
                                "description": "Please specify the appropriate chip from the list of supported chips reported by running `probe-rs-debugger list-chips`."
                            },
                            "connectUnderReset": {
                                "type": "boolean",
                                "description": "This option will result in the target reset pin being held high during the attach operation.",
                                "default": false
                            },
                            "speed": {
                                "type": "number",
                                "description": "Specify the protocol speed in kHz."
                            },
                            "wireProtocol": {
                                "type": "string",
                                "description": "The correct wire Protocol to use.",
                                "enum": [
                                    "Swd",
                                    "Jtag"
                                ],
                                "enumDescriptions": [
                                    "Use the Serial Wire Debug (SWD) protocol.",
                                    "Use the Joint Test Action Group (JTAG) protocol."
                                ]
                            },
                            "allowEraseAll": {
                                "type": "boolean",
                                "description": "Allow the session to erase all memory of the chip or reset it to factory default.",
                                "default": true
                            },
                            "coreConfigs": {
                                "type": "array",
                                "description": "Each MCU core will have a mandatory `coreIndex`, `programBinary`, and `chip` as well as several other optional properties.",
                                "items": {
                                    "required": [
                                        "programBinary"
                                    ],
                                    "coreIndex": {
                                        "type": "number",
                                        "description": "The zero based index of the MCU core for this session",
                                        "default": 0
                                    },
                                    "programBinary": {
                                        "type": "string",
                                        "description": "The path (relative to `cwd` or absolute) to the binary for your target firmware",
                                        "default": "./target/thumbv7em-none-eabihf/debug/${workspaceFolderBasename}"
                                    },
                                    "svdFile": {
                                        "type": "string",
                                        "description": "The path (relative to `cwd` or absolute) to the CMCIS-SVD file for your target core",
                                        "default": "./CMSIS.SVD"
                                    },
                                    "rttEnabled": {
                                        "type": "boolean",
                                        "description": "If true, the debugger will open an RTT Terminal tab for each of the active channels on the target.",
                                        "default": false
                                    },
                                    "rttChannelFormats": {
                                        "type": "array",
                                        "items": {
                                            "channelNumber": {
                                                "type": "number",
                                                "description": "The channel number to which this data format applies. If any active channel numbers are omitted, we will assume the default will be `dataFormat=String', and 'showTimestamps=false'."
                                            },
                                            "dataFormat": {
                                                "type": "string",
                                                "description": "One of the supported data formats for RTT channels.",
                                                "enum": [
                                                    "String",
                                                    "BinaryLE",
                                                    "Defmt"
                                                ],
                                                "enumDescriptions": [
                                                    "String (text) format.",
                                                    "Binary Little Endian format.",
                                                    "Deferred formatting (see: https://defmt.ferrous-systems.com)."
                                                ],
                                                "default": "String"
                                            },
                                            "showTimestamps": {
                                                "type": "boolean",
                                                "default": false,
                                                "description": "Enable the inclusion of timestamps in the RTT output for `dataFormat=String`."
                                            },
                                            "showLocation": {
                                                "type": "boolean",
                                                "default": true,
                                                "description": "Enable the inclusion of Defmt location information in the RTT output for `dataFormat=Defmt`."
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                },
                "initialConfigurations": [
                    {
                        "type": "probe-rs-debug",
                        "request": "launch",
                        "name": "probe-rs Test",
                        "cwd": "${workspaceFolder}",
                        "connectUnderReset": true,
                        "chip": "STM32H745ZITx",
                        "flashingConfig": {
                            "flashingEnabled": true,
                            "resetAfterFlashing": true,
                            "haltAfterReset": true
                        },
                        "coreConfigs": [
                            {
                                "coreIndex": 0,
                                "programBinary": "./target/thumbv7em-none-eabihf/debug/${workspaceFolderBasename}"
                            }
                        ]
                    }
                ],
                "configurationSnippets": [
                    {
                        "label": "probe-rs Debug: Launch",
                        "description": "A new configuration for embedded debugging of a user selected rust file with probe-rs.",
                        "body": {
                            "type": "probe-rs-debug",
                            "request": "launch",
                            "name": "probe-rs Test",
                            "cwd": "${workspaceFolder}",
                            "connectUnderReset": false,
                            "chip": "STM32H745ZITx",
                            "flashingConfig": {
                                "flashingEnabled": true,
                                "resetAfterFlashing": true,
                                "haltAfterReset": true
                            },
                            "coreConfigs": [
                                {
                                    "coreIndex": 0,
                                    "programBinary": "./target/thumbv7em-none-eabihf/debug/${workspaceFolderBasename}"
                                }
                            ]
                        }
                    }
                ]
            }
        ]
    }
}
